name: AzureDeploy

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
     - name: Install Az
       shell: pwsh
       run: | 
       Set-PSRepository -Name PSGallery -InstallationPolicy Trusted 
       Install-Module -Name Az -AllowClobber -Force 
       get-module -listavailable
     - name: Get Az Ps Modules
       shell: pwsh
       run: "Get-Module -listavailable"
     - name: Authenticating to Azure
       shell: pwsh
       env:
        user: ${{ secrets.USER }}
        pwd: ${{ secrets.PWD }}
        tenant: ${{ secrets.TENANT }}
       run: |
       $newpwd = ConvertTo-SecureString $env:pwd -AsPlainText -Force;
       $credential = New-Object System.Management.Automation.PSCredential($env:user, $newpwd);
       Connect-AzAccount -credential $credential -tenant $env:tenant -serviceprincipal;
       Get-AzSubscription
       #done
